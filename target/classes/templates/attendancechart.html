<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Attendance Chart</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", "Segoe UI", Arial, sans-serif;
        background: linear-gradient(120deg, #e0e7ff 0%, #f6f8fa 100%);
        margin: 0;
        padding: 0;
        min-height: 100vh;
        animation: fadeInBody 1s;
      }
      @keyframes fadeInBody {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      .attendance-chart-container {
        max-width: 700px;
        margin: 48px auto;
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 8px 32px rgba(49, 130, 206, 0.13);
        padding: 40px 48px 32px 48px;
        animation: slideIn 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55);
      }
      @keyframes slideIn {
        from {
          transform: translateY(60px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      .attendance-chart-title {
        font-size: 2rem;
        font-weight: 700;
        color: #2563eb;
        margin-bottom: 28px;
        text-align: center;
        letter-spacing: 0.5px;
        transition: color 0.3s;
      }
      .attendance-chart-title span {
        color: #0ea5e9;
        font-weight: 600;
      }
      .month-select-form {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 14px;
        margin-bottom: 32px;
        animation: fadeIn 1.2s;
      }
      .month-select-form select,
      .month-select-form button {
        padding: 9px 18px;
        border-radius: 7px;
        border: 1px solid #cbd5e1;
        font-size: 1.05rem;
        background: #f1f5f9;
        transition: border 0.2s, box-shadow 0.2s;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
      }
      .month-select-form select:focus,
      .month-select-form button:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 2px #93c5fd;
      }
      .month-select-form button {
        background: linear-gradient(90deg, #2563eb 60%, #0ea5e9 100%);
        color: #fff;
        border: none;
        cursor: pointer;
        font-weight: 600;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 8px rgba(37, 99, 235, 0.08);
        transition: background 0.2s, transform 0.2s;
      }
      .month-select-form button:hover {
        background: linear-gradient(90deg, #0ea5e9 60%, #2563eb 100%);
        transform: translateY(-2px) scale(1.04);
      }
      .attendance-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin-bottom: 26px;
        background: #f9fafb;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 12px rgba(37, 99, 235, 0.06);
        animation: fadeInTable 1.1s;
      }
      @keyframes fadeInTable {
        from {
          opacity: 0;
          transform: scale(0.98);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
      .attendance-table th,
      .attendance-table td {
        padding: 14px 12px;
        text-align: center;
        font-size: 1.05rem;
        transition: background 0.2s;
      }
      .attendance-table th {
        background: #e0e7ff;
        color: #2563eb;
        font-weight: 700;
        letter-spacing: 0.5px;
      }
      .attendance-table tr {
        transition: background 0.25s;
      }
      .attendance-table tr:hover td {
        background: #e0f2fe;
      }
      .attendance-table tr:nth-child(even) td {
        background: #f1f5f9;
      }
      .attendance-table td.present {
        color: #22c55e;
        font-weight: 700;
        animation: popIn 0.5s;
      }
      .attendance-table td.absent {
        color: #ef4444;
        font-weight: 700;
        animation: popIn 0.5s;
      }
      .attendance-table td.na {
        color: #64748b;
        font-style: italic;
      }
      @keyframes popIn {
        from {
          transform: scale(0.8);
          opacity: 0.5;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }
      .attendance-summary {
        margin-top: 22px;
        text-align: center;
        font-size: 1.15rem;
        color: #334155;
        background: #e0e7ff;
        border-radius: 8px;
        padding: 12px 0;
        box-shadow: 0 1px 4px rgba(37, 99, 235, 0.05);
        animation: fadeIn 1.3s;
      }
      .attendance-summary span {
        font-weight: 700;
        color: #2563eb;
        font-size: 1.18rem;
        transition: color 0.2s;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      /* Animated check/cross icons */
      .icon {
        display: inline-block;
        vertical-align: middle;
        width: 22px;
        height: 22px;
        margin-right: 6px;
        animation: iconPop 0.5s;
      }
      @keyframes iconPop {
        from {
          transform: scale(0.7);
          opacity: 0.4;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <div class="attendance-chart-container">
      <div class="attendance-chart-title">Attendance Chart</div>
      <form
        class="month-select-form"
        action="/studentspage/getSingleStudentInfo/attendance/chart"
        method="get"
      >
        <input type="hidden" name="studentId" th:value="${studentChart.id}" />
        <label for="month" style="font-weight: 600; color: #2563eb"
          >Month:</label
        >
        <label for="month">Month:</label>
        <select name="month" id="month" required>
            <option value="1">January</option>
            <option value="2">February</option>
            <option value="3">March</option>
            <option value="4">April</option>
            <option value="5">May</option>
            <option value="6">June</option>
            <option value="7">July</option>
            <option value="8">August</option>
            <option value="9">September</option>
            <option value="10">October</option>
            <option value="11">November</option>
            <option value="12">December</option>
        </select>
        <label for="year" style="font-weight: 600; color: #2563eb">Year:</label>
        <select name="year" id="year" required>
          <option value="2025">2025</option>
          <option value="2024">2024</option>
          <option value="2023">2023</option>
          <option value="2022">2022</option>
        </select>
        <button type="submit">View</button>
      </form>
      <table class="attendance-table">
        <tr>
          <th>Date</th>
          <th>Status</th>
        </tr>
        <!-- Loop through the map's entrySet -->
        <tr th:each="entry : ${attendanceMap.entrySet()}">
          <td th:text="${entry.key}">2024-06-01</td>
          <td th:classappend="${entry.value} ? 'present' : 'absent'">
            <span th:if="${entry.value}">
              <svg class="icon" viewBox="0 0 20 20" fill="none">
                <circle cx="10" cy="10" r="10" fill="#bbf7d0" />
                <path
                  d="M6 10.5l3 3 5-6"
                  stroke="#22c55e"
                  stroke-width="2"
                  fill="none"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              Present
            </span>
            <span th:unless="${entry.value}">
              <svg class="icon" viewBox="0 0 20 20" fill="none">
                <circle cx="10" cy="10" r="10" fill="#fee2e2" />
                <path
                  d="M7 7l6 6M13 7l-6 6"
                  stroke="#ef4444"
                  stroke-width="2"
                  stroke-linecap="round"
                />
              </svg>
              Absent
            </span>
          </td>
        </tr>
      </table>
      <div class="attendance-summary">
        Presents:
        <span id="presentCount" th:text="${presentCount}"
          >0</span
        >
        &nbsp;|&nbsp; Absents:
        <span id="absentCount" th:text="${absentCount}"
          >0</span
        >
      </div>
    </div>
    <script>
        (function() {
                const params = new URLSearchParams(window.location.search);
                const month = params.get('month');
                if (month) {
                    document.getElementById('month').value = month;
                }
            })();
      // Animate summary numbers on load
      function animateCount(id, end) {
        const el = document.getElementById(id);
        if (!el) return;
        let start = 0;
        const duration = 700;
        const step = Math.ceil(end / (duration / 20));
        function update() {
          start += step;
          if (start >= end) {
            el.textContent = end;
          } else {
            el.textContent = start;
            requestAnimationFrame(update);
          }
        }
        update();
      }
      window.addEventListener("DOMContentLoaded", function () {
        const present =
          parseInt(document.getElementById("presentCount").textContent, 10) ||
          0;
        const absent =
          parseInt(document.getElementById("absentCount").textContent, 10) || 0;
        animateCount("presentCount", present);
        animateCount("absentCount", absent);
      });
    </>
  </body>
</html>
